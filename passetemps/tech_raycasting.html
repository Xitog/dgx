<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Raycasting : FPS en 2.5D</title>
    <link rel="icon" href="https://xitog.github.io/dgx/img/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="https://xitog.github.io/dgx/img/favicon.ico" type="image/x-icon" />
    <link href="https://xitog.github.io/dgx/css/simplex.bootstrap.css" rel="stylesheet">
    <link href="https://xitog.github.io/dgx/css/palatino.css" rel="styleSheet" type="text/css">
    <!--<link rel="stylesheet" type="text/css" href="../css/style2018.css">-->
    <!-- Created 20 september 2017 -->
    <style>
      div.palatino p {
        text-align: justify;
      }
      ol#menu a {
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div id="main" class="container">
     
<nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
             <a class="navbar-brand" href="#">Menu</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li id="Accueil"><a href="https://xitog.github.io/dgx/index.html">Accueil</a></li>
              <li id="Blog"><a href="https://xitog.github.io/dgx/blog.html">Blog</a></li>
              <li class="dropdown">
                <a id="Langues" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Langues <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                <li class="dropdown-header">Français</li>
                  <li><a href="https://xitog.github.io/dgx/francais/fiche_api_fr.html">Fiche sur les phonèmes du français</a></li>
                  <li><a href="https://xitog.github.io/dgx/francais/outil_stats_fr.html">Outil d'analyse textuelle</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Italien</li>
                  <li><a href="https://xitog.github.io/dgx/italien/beatrice.html">Beatrice : grammaire</a></li>
                  <li><a href="https://xitog.github.io/dgx/italien/jeu_conjugaison.html">Jeu sur la conjugaison</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Anglais</li>
                  <li><a href="https://xitog.github.io/dgx/anglais/jeu_vocabulaire.html">Jeu sur le vocabulaire</a></li>
                  <li><a href="https://xitog.github.io/dgx/anglais/verbes.html">Verbes fréquents</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Interlingua</li>
                  <li><a href="https://xitog.github.io/dgx/interlingua/conjugueur.html">Conjugueur</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Linguistique</li>
                  <li><a href="https://xitog.github.io/dgx/linguistique/informations.html">Informations générales</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a id="Informatique" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Informatique <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li class="dropdown-header">Programmation</li>
                  <li><a href="https://xitog.github.io/dgx/informatique/syntaxes.html">Syntaxes comparées</a></li>
                  <li><a href="https://xitog.github.io/dgx/informatique/python.html">Aide-mémoire Python</a></li>
                  <li><a href="https://xitog.github.io/dgx/informatique/ruby.html">Aide-mémoire Ruby</a></li>
                  <li><a href="https://xitog.github.io/dgx/informatique/lua.html">Aide-mémoire Lua</a></li>
                  <li><a href="https://xitog.github.io/dgx/informatique/ruby_guide.html">Guide Ruby</a></li>
                  <li><a href="https://xitog.github.io/dgx/informatique/ash_guide.html">Guide Ash</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Modélisation</li>
                  <li><a href="https://xitog.github.io/dgx/informatique/bnf.html">Aide-mémoire BNF et EBNF</a></li>
                  <li><a href="https://xitog.github.io/dgx/informatique/json.html">Aide-mémoire JSON</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Autres</li>
                  <li><a href="https://xitog.github.io/dgx/informatique/outils.html">Logiciels utiles</a></li>
                  <li><a href="https://xitog.github.io/dgx/data/outil_collections.html#langages">Liste de langages</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a id="Histoire" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Histoire <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li class="dropdown-header">Méthode</li>
                  <li><a href="https://xitog.github.io/dgx/histoire/methode.html">Généralités</a></li>
                  <li><a href="https://xitog.github.io/dgx/histoire/bibliographie.html">Bibliographie</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Aide-mémoires</li>
                  <li><a href="https://xitog.github.io/dgx/histoire/france19eme.html">France au XIXe</a></li>
                </ul>
              </li>
              <li class="dropdown active">
                <a id="Jeux" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Jeux <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li class="dropdown-header">Jeux de rôles</i></li>
                  <li><a href="https://xitog.github.io/dgx/jeux/systemes_rpg.html">Systèmes des RPG</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Livres-jeux</li>
                  <li><a href="https://xitog.github.io/dgx/jeux/compagnon_talisman.html">Le Compagnon du Talisman</a></li>
                  <li><a href="https://xitog.github.io/dgx/jeux/compagnon_sorcier.html">Le Compagnon du Sorcier</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Histoire des jeux vidéo</li>
                  <li><a href="https://xitog.github.io/dgx/jeux/rts.html">Les enfants de Dune : les RTS</a></li>
                  <li><a href="https://xitog.github.io/dgx/data/outil_collections.html#jv">Jeux vidéo favoris</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Techniques des jeux vidéo</i></li>
                  <li><a href="https://xitog.github.io/dgx/jeux/raycasting.html" class="active">Le raycasting : la 2.5D</a></li>
                  <li><a href="https://xitog.github.io/dgx/jeux/transitions.html">Cartes et transitions</a></li>
                  <li><a href="https://xitog.github.io/dgx/jeux/dialogues.html">Dialogues</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Jeux vidéo maison</i></li>
                  <li><a href="https://xitog.github.io/dgx/jeux/play_rts.html">Jouer à mon RTS</a></li>
                  <li><a href="https://xitog.github.io/dgx/jeux/play_fps.html">Jouer à mon FPS</a></li>
                  
                </ul>
              </li>
              <li class="dropdown">
                <a id="Autres" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Autres <span class="caret"></span></a>
                <ul class="dropdown-menu" role="menu">
                  <li class="dropdown-header">Musique</li>
                  <li><a href="https://xitog.github.io/dgx/concerts_classiques/index.html">Concerts classiques</a></li>
                  <li><a href="https://xitog.github.io/dgx/favoris/musiques.html">Musiques favorites</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Collections</li>
                  <li><a href="../data/outil_collections.html#prenoms">Prénoms</a></li>
                  <li><a href="https://xitog.github.io/dgx/data/outil_collections.html#livres">Livres lus</a></li>
                  <li><a href="https://xitog.github.io/dgx/data/outil_collections.html#favoris_artistiques">Favoris artistiques</a></li>
                  <li class="divider"></li>
                  <li class="dropdown-header">Liens</li>
                  <li><a href="https://xitog.github.io/dgx/liens.html">Barre de liens</a></li>
                  <li><a href="https://xitog.github.io/dgx/liste_liens.html">Collection de liens</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <div id="content" class="palatino">
        
        <h1 class="title">Raycasting pour FPS en 2.5D</h1>
        <h1>Sommaire</h1>
        <ol id="menu">
          <li><a href="#intro">Introduction</a></li>
          <li><a href="#historique">Historique</a></li>
          <li><a href="#technique">Technique</a></li>
          <li><a href="#liens">Liens</a></li>
          <li><a href="#histoprojet">Historique du projet</a></li>
        </ol>
        <p>Cette page décrit la technique du raycasting utilisée par les FPS en 2.5D. Retour à l'<a href="https://xitog.github.io/dgx/index.html">index</a>.</p>
        
        <h1 id="intro">1. Introduction</h2>

        <p>Le <a href="https://en.wikipedia.org/wiki/Ray_casting">raycasting</a> (lancer de rayons) est une technique dans les jeux vidéo pour, à partir d'une carte en 2D, afficher en temps réel un environnement qui à l'apparence d'une 3D rudimentaire. On appelle parfois cette technique et ce rendu de la « <a href="https://en.wikipedia.org/wiki/2.5D">2.5D</a> », terme qui regroupe également d'autres techniques de représentation d'un environnement 3D dont nous ne parlerons pas ici. L'avantage du raycasting est d'être <i>rapide</i>. Il ne faut pas confondre <i>raycasting</i> et <i>raytracing</i>. Cette dernière technologie est beaucoup plus coûteuse en temps de calcul et simule le parcours de la lumière pour essayer d'atteindre une qualité photoréaliste. Notons enfin que si le raycasting est rapide sur les résolutions de l'époque, 320x200, 640x400 ou 640x480, ses performances sont très mauvaises sur nos grandes résolutions modernes et il vaut mieux passer par des techniques modernes.</p>
      
        <h1 id="historique">2. Historique</h1>
    
        <p>Le jeu qui a popularisé cette technique est <a href="https://en.wikipedia.org/wiki/Wolfenstein_3D">Wolfenstein 3D</a>, d'id Software, sorti le 5 mai 1992. Le raycasting était une technique bien adaptée à la puissance des machines de l'époque, codée avec brio par <a href="https://en.wikipedia.org/wiki/John_Carmack">John Carmack</a>, et mis au service dans ce jeu d'un gameplay simple et rapide, dans une direction artistique faisant la part belle à la violence (pour l'époque) et aux décorations nazies, les ennemis du jeu.</p>
    
        <p>Le moteur qui implémente le raycasting dans Wolfenstein 3D propose néanmoins des fonctionnalités très rudimentaires : le niveau est stocké dans un tableau. Tous les murs ont la même hauteur, ont une longueur qui est toujours un multiple d'une valeur de base, ils se croisent toujours perpendiculairement, le sol et le plafond ne sont pas texturés, la lumière est statique. Le moteur offre néanmoins des murs texturés, des portes, des sprites pour les ennemis, les objets et les lumières statiques.</p>
    
        <p>Avant Wolfenstein 3D, John Carmack avait développé en 1991 le moteur de Hovertank 3D pour son précédent employeur, Softdisk. Celui-ci fut amélioré pour Catacomb 3-D en 1991. Un autre développeur, Blue Sky Productions était lui en train de programmer Ultima Underworld: The Stygian Abyss, un autre jeu utilisant le raycasting comme principe.</p>
    
        <p>id Software a vendu le moteur de Wolfenstein 3D à différentes équipes de développement, qui en retour l'ont utilisé dans différents jeux, parfois en le changeant profondemment.</p>
    
        <p>Avec la sortie du jeu suivant d'id Software, Doom, en XXXX, le moteur de Wolfenstein 3D prend un sérieux coup de vieux. Les derniers feux du raycasting brilleront avec Dark Forces, Duke Nukem 3D, Shadow Warrior et Blood, ces trois derniers utilisant le Build engine comme moteur.</p>
        
        <h1 id="technique">3. Technique</h1>
        
        <h2>3.1 Principe</h2>
        
        <p>Un niveau est représenté par une grille. Chaque case de la grille peut avoir pour valeur 0, signifiant qu'il n'y a rien et que le joueur peut se déplacer dans cette-ci ou une valeur supérieure à 0. Dans ce cas, il y a un mur qui empêche les déplacements. La texture du mur est donnée par la valeur de la case.</p>
        
        <p>La position du joueur est représenté par un point sur cette grille, <b>pos</b>. Il regarde dans une direction donnée, uniquement sur deux axes, qui est matérialisée à la fois par un angle <b>AP</b> et par un vecteur, le vecteur <b>dir</b> qui a pour norme 1, c'est-à-dire que <b>cos AP = dir.x</b> et <b>sin AP = dir.y</b>. Le joueur a également un plan caméra : il s'agit d'un vecteur nommé <b>cam</b> perpendiculaire au vecteur dir. Il représente l'écran à dessiner. Le champ de vision du joueur est représenté par un angle, le <b>FOV</b> pour <i>field of view</i> en anglais. Le FOV est une valeur absolue, pour savoir les limites sur la grille de son champ de vision, il faut faire <b>AP - FOV/2</b> et <b>AP + FOV/2</b> : son champ de vision est réparti égalitairement de part et d'autre de son vecteur dir.</p>
        
        <p>Nous allons lancer des rayons à partir de la position du joueur. Nous allons lancer autant de rayons que la largeur de l'écran que nous voulons dessiner.</p>
        
        <h2>3.2 Texturation</h2>
        
        <p>Une texture est une image qui va être appliqué à un objet de l'environnement, on dit dans ce cas que l'objet est texturé. Un calcul est effectué pour savoir quel pixel de la texture dessiner sur un pixel représentant l'objet à l'écran. En anglais on parle de <b>texture mapping</b>.</p>
        <p>Les premiers jeux utilisant le raycasting n'avait pas d'objets texturés (Hovertank 3D, 1991). Puis il y eu des jeux avec les murs texturés (Catacomb 3D, 1991). Et enfin des jeux avec également les sols et les plafonds texturés (Blake Stone: Aliens of Gold, 1993).</p>
        <p>Un raycaster dessine les textures colonnes par colonnes, il est donc plus efficace de les stocker ainsi en mémoire, c'est-à-dire faire un tableau de tableaux, ces derniers représentent les colonnes.</p>
        <p>Une technique simple pour simuler l'effet de la lumière est de dessiner les textures de façon plus claire, pour simuler une forte luminosité, ou plus sombre, pour l'obscurité. Deux techniques existent : avoir en mémoire plusieurs versions de la texture, le calcul est donc déjà fait, ou calculer à la volée la couleur définitive à partir d'une seule texture de départ. Pour obscurir, il suffit de diminuer les valeurs RGB de chaque pixel et pour illuminer, il faut augmenter ces mêmes valeurs.</p>

        <h1 id="liens">4. Liens</h1>
        
        <ul>
          <li>Avant Wolfenstein
            <ul>
              <li>Hovertank 3D</li>
              <li>Catacombs</li>
            </ul>
          </li>
          <li><b>Wolfenstein</b> by John Carmack [<a href="http://www.mobygames.com/game-group/3d-engine-wolf3d">moby</a>]
            <ul>
              <li>Wolfenstein 3D</li>
              <li>Blake Stone: Aliens of Gold [<a href="https://en.wikipedia.org/wiki/Blake_Stone:_Aliens_of_Gold">wiki</a>]  (JAM Productions, 1993)</li>
              <li>Blake Stone: Planet Strike [<a href="https://en.wikipedia.org/wiki/Blake_Stone:_Planet_Strike">wiki</a>] (JAM Productions, 1994)</li>
              <li>Corridor 7</li>
              <li>Operation Body Count</li>
              <li>Super 3D Noah's Ark</li>
              <li>Rise of the Triad [<a href="https://en.wikipedia.org/wiki/Rise_of_the_Triad">wiki</a>] (Apogee Software, 1994)</li>
            </ul>
          </li>
          <li><b>Id Tech 1</b> by John Carmack
            <ul>
              <li>Doom</li>
              <li>Doom II</li>
              <li>Strife</li>
            </ul>
          </li>
          <li><b>Build Engine</b> by Ken Silverman [<a href="http://www.mobygames.com/game-group/25d-engine-build">moby</a>]
            <ul>
              <li>Technique
                <ul>
                  <li><a href="http://advsys.net/ken/buildsrc/">Site officiel de Ken sur le Build</a></li>
                  <li><a href="http://advsys.net/ken/buildsrc/build2.htm">Site officiel de Ken sur le Build 2</a></li>
                  <li><a href="https://www.youtube.com/watch?v=VSVzn0F3pyQ">Son histoire par CuteFloor</a></li>
                  <li><a href="https://www.youtube.com/watch?v=3qtmkkdND6M">Vidéo sur Build 2 par CuteFloor</a></li>
                </ul>
              </li>
              <li>Jeux
                <ul>
                  <li><b>1995</b> TekWar [<a href="https://www.mobygames.com/game/william-shatners-tekwar">moby</a>]
                  <li><b>1995</b> Witchaven [<a href="https://www.mobygames.com/game/witchaven">moby</a>]
                  <li><b>1996</b> Duke Nukem 3D [<a href="http://www.mobygames.com/game/dos/duke-nukem-3d">moby</a>]<br>
                      US shareware : jan 1996, US registered : may 1996, FR, registered : sep 1996</li>
                  <li><b>1996</b> Witchaven II [<a href="https://www.mobygames.com/game/witchaven-ii-blood-vengeance">moby</a>]</li>
                  <li><b>1996</b> Powerslave / Exhumed [<a href="https://www.mobygames.com/game/powerslave">moby</a>]</li>
                  <li><b>1997</b> Blood [<a href="https://www.mobygames.com/game/blood">moby</a>]</li>
                  <li>Redneck Rampagne</li>
                  <li><b>1997</b> Shadow Warrior [<a href="https://www.mobygames.com/game/shadow-warrior">moby</a>]</li>
                  <li>Fate (unreleased)
                    <ul>
                      <li><a href="https://www.youtube.com/watch?v=sUOZwQneA-4">Vidéo de gameplay de la démo</a></li>
                    </ul>
                  </li>
                  <li><b>2018</b> Ion Maiden [<a href="https://www.mobygames.com/game/ion-maiden">moby</a>]</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>Autres moteurs
            <ul>
              <li>Jedi engine
                <ul>
                  <li><b>1995</b> Dark Forces (Jedi engine) [<a href="https://www.mobygames.com/game/star-wars-dark-forces">moby</a>]</li>
                  <li><b>1997</b> Outlaws (Jedi engine) [<a href="https://www.mobygames.com/game/outlaws">moby</a>]</li>
                  <li>Ultima Underworld: The Stygian Abyss</li>
                  <li>Skynet</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
        
            
        <p>De nombreux sites et vidéos traitent de ce sujet. En particulier, je tiens à remercier Lode Vandevenne pour sa <a href="http://lodev.org/cgtutor/">série d'articles sur le Raycasting</a> et bien sûr les contributeurs anonymes de Wikipédia.</p>
        <ul>
          <li><a href="https://www.youtube.com/watch?v=-5nhdEDGaws">Vidéo d'un moteur avancé</a> basé sur le tutoriel de Lode Vandevenne qui rajoute des plusieurs niveaux, des murs fins, un ciel panoramique et du brouillard.</li>
        </ul>
    
        <p>Bibliothèques pour programmer des jeux :</p>
        <ul>
          <li>C
            <ul>
              <li><a href="http://liballeg.org/">Allegro</a></li>
              <li><a href="https://www.libsdl.org/">SDL 1 et 2</a></li>
              <li><a href="https://www.sfml-dev.org">SFML</a></li>
            </ul>
          </li>
          <li>Lua
            <ul>
              <li>Löve</li>
            </ul>
          </li>
          <li>Python
            <ul>
              <li><a href="http://www.pygame.org">Pygame</a></li>
              <li><a href="https://python-sfml.org/">SFML</a></li>
            </ul>
          </li>
          <li>Ruby
            <ul>
              <li>Gosu</li>
              <li>SFML</li>
            </ul>
          </li>
          <li>Java
            <ul>
              <li>libGDX</li>
            </ul>
          </li>
        </ul>
    
        <p>Le jeu est <a href="http://3d.wolfenstein.com/game_EU.php">jouable en ligne</a> dans une version codée en JavaScript.</p>
        
        <h1 id="histoprojet">5. Historique du projet</h1>
        <ul>
          <li><b>27 novembre 2019</b> : calcul de la distance orthogonale OK. Il faut :
            <ol>
              <li>Calculer la distance sur le plan caméra <b>DPC</b> entre le vecteur dir et le rayon, où <b>A</b> est la différence d'angle entre le vecteur dir et le rayon.</li>
              <li>Utiliser la formule <b>tan A  = DPC / norme dir</b>, donc comme la norme de dir est égale à 1, on obtient <b>A = atan DPC</b> et donc la valeur de <b>A</b>.</li>
              <li>On a la distance <b>D</b> entre le point de collision entre le rayon et un mur. Utiliser la formule <b>cos A = distance orthogonale DO / D</b>, donc <b>DO = cos A * D</b> et on obtient <b>DO</b>.
            </ol>
          </li>
          <li><b>6 novembre 2019</b> : lors d'un parcours de grille par un rayon, les distances entre deux lignes sont constantes, de même que pour les colonnes.</li>
          <li><b>été 2019</b> : comme chaque colonne fait 1 pixel, l'incrément d'angle pour décrire les rayons émis n'est pas constant.</li>
        </ul>
      </div>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
    </div>

</body>
</html>
